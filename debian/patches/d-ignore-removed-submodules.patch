Description: Ignore submodules that we're not building
Author: Ximin Luo <infinity0@debian.org>
Forwarded: not-needed
--- a/src/Cargo.toml
+++ b/src/Cargo.toml
@@ -15,27 +15,8 @@
   "tools/remote-test-client",
   "tools/remote-test-server",
   "tools/rust-installer",
-  "tools/cargo",
   "tools/rustdoc",
-  "tools/rls",
-  "tools/rustfmt",
-  "tools/miri",
   "tools/rustdoc-themes",
-  # FIXME(https://github.com/rust-lang/cargo/issues/4089): move these to exclude
-  "tools/rls/test_data/bin_lib",
-  "tools/rls/test_data/borrow_error",
-  "tools/rls/test_data/common",
-  "tools/rls/test_data/deglob",
-  "tools/rls/test_data/features",
-  "tools/rls/test_data/find_all_refs_no_cfg_test",
-  "tools/rls/test_data/find_impls",
-  "tools/rls/test_data/infer_bin",
-  "tools/rls/test_data/infer_custom_bin",
-  "tools/rls/test_data/infer_lib",
-  "tools/rls/test_data/multiple_bins",
-  "tools/rls/test_data/reformat",
-  "tools/rls/test_data/reformat_with_range",
-  "tools/rls/test_data/workspace_symbol",
 ]
 
 # These options are controlled from our rustc wrapper script, so turn them off
@@ -59,19 +40,3 @@
 debug = false
 debug-assertions = false
 
-# We want the RLS to use the version of Cargo that we've got vendored in this
-# repository to ensure that the same exact version of Cargo is used by both the
-# RLS and the Cargo binary itself. The RLS depends on Cargo as a git repository
-# so we use a `[patch]` here to override the github repository with our local
-# vendored copy.
-[patch."https://github.com/rust-lang/cargo"]
-cargo = { path = "tools/cargo" }
-
-[patch.crates-io]
-# Similar to Cargo above we want the RLS to use a vendored version of `rustfmt`
-# that we're shipping as well (to ensure that the rustfmt in RLS and the
-# `rustfmt` executable are the same exact vesion). Unlike Cargo, however, the
-# RLS depends on `rustfmt` from crates.io, so we put this in a `[patch]` section
-# for crates.io
-rustfmt-nightly = { path = "tools/rustfmt" }
-clippy_lints = { path = "tools/clippy/clippy_lints" }
--- a/src/bootstrap/bootstrap.py
+++ b/src/bootstrap/bootstrap.py
@@ -618,10 +618,6 @@
                 os.path.join(self.rust_root, "src/bootstrap/Cargo.toml")]
         for _ in range(1, self.verbose):
             args.append("--verbose")
-        if self.use_locked_deps:
-            args.append("--locked")
-        if self.use_vendored_sources:
-            args.append("--frozen")
         run(args, env=env, verbose=self.verbose)
 
     def build_triple(self):
--- a/src/bootstrap/builder.rs
+++ b/src/bootstrap/builder.rs
@@ -589,8 +589,5 @@
 
-        if self.config.locked_deps {
-            cargo.arg("--locked");
-        }
-        if self.config.vendor || self.is_sudo {
+        if self.is_sudo {
             cargo.arg("--frozen");
         }
 
--- a/src/bootstrap/doc.rs
+++ b/src/bootstrap/doc.rs
@@ -141,7 +141,7 @@ pub struct CargoBook {
 
 impl Step for CargoBook {
     type Output = ();
-    const DEFAULT: bool = true;
+    const DEFAULT: bool = false;
 
     fn should_run(run: ShouldRun) -> ShouldRun {
         let builder = run.builder;
--- a/src/doc/index.md
+++ b/src/doc/index.md
@@ -49,7 +49,7 @@ accomplishing various tasks.
 
 ## The Cargo Book
 
-[The Cargo Book](cargo/index.html) is a guide to Cargo, Rust's build tool and dependency manager.
+[The Cargo Book](../../cargo-doc/doc/index.html) is a guide to Cargo, Rust's build tool and dependency manager.
 
 ## The Rustdoc Book
 
